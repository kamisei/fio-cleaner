<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Загрузка CSV</title>
  </head>
  <body>
    <h1>Загрузка CSV</h1>

    {% if error %}
      <p style="color: #b00020;"><strong>Ошибка:</strong> {{ error }}</p>
    {% endif %}

    {% if success %}
      <p style="color: #0a7a0a;"><strong>Готово.</strong></p>
      <ul>
        <li>Имя файла: <code>{{ original_name }}</code></li>
        <li>Сохранено как: <code>{{ saved_path }}</code></li>
        <li>Ссылка (dev): <a href="{{ file_url }}">{{ file_url }}</a></li>
      </ul>

      <h2>Предпросмотр</h2>

      {% if preview_error %}
        <p style="color: #b00020;"><strong>Ошибка предпросмотра:</strong> {{ preview_error }}</p>
      {% elif preview_columns %}
        <p><strong>Определено:</strong></p>
        <ul>
          {% if preview_encoding %}<li>Кодировка: <code>{{ preview_encoding }}</code></li>{% endif %}
          {% if preview_delimiter %}<li>Разделитель: <code>{{ preview_delimiter }}</code></li>{% endif %}
        </ul>

        <p>Колонки ({{ preview_columns|length }}):</p>
        <ul>
          {% for c in preview_columns %}
            <li><code>{{ c }}</code></li>
          {% endfor %}
        </ul>

        <p>Первые {{ preview_rows_limit }} строк:</p>
        <table border="1" cellpadding="6" cellspacing="0">
          <thead>
            <tr>
              {% for c in preview_columns %}
                <th>{{ c }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in preview_rows %}
              <tr>
                {% for cell in row %}
                  <td>{{ cell }}</td>
                {% endfor %}
              </tr>
            {% empty %}
              <tr>
                <td colspan="{{ preview_columns|length }}">Нет строк данных.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>Нет данных для предпросмотра.</p>
      {% endif %}

      <hr />
    {% endif %}

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div>
        <label for="csv_file">CSV-файл:</label>
        <input id="csv_file" name="csv_file" type="file" accept=".csv,text/csv" required />
      </div>

      <div style="margin-top: 12px;">
        <button type="submit">Загрузить</button>
      </div>
    </form>
  </body>
</html>
