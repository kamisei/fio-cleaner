# Roadmap проекта: сервис очистки ФИО (с подтверждением решений)

## Коротко о продукте
Мы делаем веб-приложение, которое помогает человеку принимать решения по проблемным ФИО:
- система делает безопасную нормализацию автоматически;
- находит проблемы, объясняет их и (если может) предлагает вариант исправления;
- пользователь подтверждает предложенный вариант или вводит свой;
- на основе решений пользователя формируются итоговые значения;
- сохраняется прозрачность: было → стало → почему.

Критерий "продукт готов": пользователь может подтвердить/ввести вариант в интерфейсе.

---

## Лестница шагов

### Шаг 1. Загрузка CSV и предпросмотр — ✅ завершён

Реализовано:
- загрузка CSV-файла через веб-интерфейс;
- сохранение файла на сервере (MEDIA_ROOT);
- предпросмотр столбцов и первых строк данных;
- выбор поля(ей) ФИО:
  - режим «одно поле» (ФИО целиком);
  - режим «отдельные поля» с возможностью выбрать 1–3 поля (Ф/И/О);
- сохранение выбора пользователя;
- прозрачные метрики по выбранным полям:
  - количество проверенных строк;
  - процент заполненности;
  - примеры значений;
- неблокирующие предупреждения для редких/пустых полей.

Статус: шаг полностью реализован и протестирован локально.

---

### Шаг 2. Автонормализация без риска (в разработке)

Цель шага: показать пользователю безопасную автонормализацию выбранных полей ФИО
**в режиме предпросмотра**, без угадывания и без изменения смысла данных.

Принципы:
- нормализация только формата, не смысла;
- все изменения прозрачны и обратимы;
- ничего не сохраняется как итоговое значение;
- одинаково работает для одного поля и для нескольких.

#### 2.1 Явная точка входа в UI (MVP)
После подтверждения выбранных полей (Шаг 1) на странице появляется отдельный блок
**«Шаг 2. Нормализация»** с кнопкой:

- «показать нормализацию» (preview)

По нажатию открывается отдельная страница/экран, где отображается контекст:
- название загруженного файла;
- базовая информация по файлу (например: количество строк);
- выбранные пользователем поля ФИО;
- допускается повтор краткой статистики из Шага 1.

На этом этапе допустима заглушка вместо таблицы нормализации —
цель инкремента: зафиксировать правильное место шага в интерфейсе.

#### 2.2 Безопасная нормализация значений + справочники (MVP)
Добавляется нормализация отдельных значений ФИО, применяемая независимо
к каждому выбранному полю.

Разрешённые действия:
- очистка пробелов;
- удаление мусорных/невидимых символов;
- нормализация тире;
- приведение регистра.

Запрещено:
- угадывание;
- исправление опечаток;
- транслитерация;
- склейка или перестановка частей ФИО.

Технические статусы:
- `ok`
- `fixed`
(в будущем: `needs_review`, `error`)

Пользовательские подписи (все строчными):
- `ok` → «ок»
- `fixed` → «нормализовано»
- `needs_review` → «требует проверки»

Все пользовательские тексты и статусы хранятся в словарях/константах,
чтобы их можно было менять без изменения бизнес-логики.

#### 2.3 Результаты нормализации (MVP)
На странице нормализации отображается:

1) Сводка по строкам:
   - сколько строк без изменений (`ок`);
   - сколько строк с нормализацией (`нормализовано`);
   - количество и доля.

2) Примеры:
   - выводится N строк, где была выполнена нормализация
     (если хотя бы в одном выбранном поле были изменения).

3) Если нормализованных строк нет:
   - сообщение «изменений не обнаружено»;
   - дополнительно показываются N строк примеров (например, верхние строки файла).

Примечание: на уровне MVP N фиксированный (например, 20).

---

### Отложенные улучшения Шага 2 (после MVP / не обязательно сразу)
- статистика по типам нормализаций (что исправлялось чаще всего);
- возможность выбрать количество строк или «показать ещё»;
- случайная выборка примеров при отсутствии изменений (с фиксированным seed);
- более детальная статистика по полям (не только по строкам, но и по ячейкам);
- улучшение визуального выделения изменений.

---

### Шаг 3. Флаги проблем + ранняя выгрузка
- флаги needs_review/error;
- комментарии;
- выгрузка CSV с:
  fio_raw, fio_norm, fio_suggest, fio_status, fio_flags, fio_comment.

### Шаг 4. Принятие решений пользователем
- принять предложение;
- оставить как есть;
- ввести свой вариант.

### Шаг 5. Финальная выгрузка
- итоговое поле на основе решений.

### Шаг 6. Улучшения
- групповые решения;
- фильтры;
- повторные прогоны;
- справочники.
